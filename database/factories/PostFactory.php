<?php

namespace Database\Factories;

use Illuminate\Database\Eloquent\Factories\Factory;

/**
 * @extends \Illuminate\Database\Eloquent\Factories\Factory<\App\Models\Post>
 */
class PostFactory extends Factory
{
    /**
     * Define the model's default state.
     *
     * @return array<string, mixed>
     */
    public function definition(): array
    {
        // Массивы для генерации русскоязычного контента о диабете
        $titles = [
            'Как правильно измерять уровень глюкозы в крови',
            'Диета при сахарном диабете: основные принципы',
            'Физические упражнения для людей с диабетом',
            'Инсулинотерапия: что нужно знать каждому',
            'Гликемический индекс продуктов: полная таблица',
            'Осложнения диабета и как их избежать',
            'Современные глюкометры: как выбрать лучший',
            'Питание при диабете 2 типа: меню на неделю',
            'Симптомы гипогликемии и первая помощь',
            'Как подсчитывать хлебные единицы',
            'Сахарозаменители: польза и вред',
            'Диабет и беременность: что важно знать',
            'Профилактика диабетической стопы',
            'Инновации в лечении диабета',
            'Психологическая поддержка при диабете',
            'Школа диабета: обучение самоконтролю',
            'Углеводы в рационе диабетика',
            'Мониторинг глюкозы: традиционный и непрерывный',
            'Диабет у детей: особенности ухода',
            'Путешествия с диабетом: советы и рекомендации',
        ];

        $excerpts = [
            'Узнайте о правильных методах контроля уровня сахара в крови и частоте измерений для эффективного управления диабетом.',
            'Основные принципы здорового питания при сахарном диабете, которые помогут контролировать уровень глюкозы.',
            'Рекомендации по физической активности для людей с диабетом, безопасные виды спорта и правила тренировок.',
            'Полное руководство по инсулинотерапии: виды инсулина, схемы введения и правила хранения.',
            'Подробная информация о гликемическом индексе продуктов и его влиянии на уровень сахара в крови.',
            'Как предотвратить развитие осложнений диабета и сохранить качество жизни на долгие годы.',
            'Обзор современных глюкометров, их характеристики и советы по выбору подходящего устройства.',
            'Сбалансированное меню на неделю для людей с диабетом 2 типа с учетом всех необходимых нутриентов.',
            'Признаки низкого уровня сахара в крови и алгоритм действий при гипогликемии.',
            'Практическое руководство по подсчету хлебных единиц для правильного расчета дозы инсулина.',
        ];

        $contentParagraphs = [
            'Сахарный диабет требует постоянного внимания к своему здоровью и образу жизни. Правильный подход к управлению заболеванием позволяет жить полноценной жизнью и избежать серьезных осложнений.',
            'Современная медицина предлагает множество эффективных методов контроля диабета. Важно регулярно консультироваться с эндокринологом и следовать его рекомендациям.',
            'Питание играет ключевую роль в управлении диабетом. Сбалансированный рацион помогает поддерживать стабильный уровень глюкозы и предотвращать резкие скачки сахара в крови.',
            'Физическая активность необходима для людей с диабетом. Регулярные упражнения улучшают чувствительность к инсулину и помогают контролировать вес.',
            'Самоконтроль уровня глюкозы - основа успешного управления диабетом. Регулярные измерения позволяют своевременно корректировать лечение.',
            'Образование и информированность пациента - важнейшие факторы успешного лечения. Знание особенностей своего заболевания помогает принимать правильные решения.',
            'Психологическое состояние влияет на течение диабета. Важно научиться справляться со стрессом и поддерживать позитивный настрой.',
            'Технологии в области диабета постоянно развиваются. Новые устройства и методы лечения делают жизнь с диабетом более комфортной.',
            'Поддержка близких и общение с другими людьми с диабетом помогают справляться с трудностями и не чувствовать себя одиноким.',
            'Профилактика осложнений начинается с ежедневного контроля и соблюдения рекомендаций врача. Внимательное отношение к своему здоровью - залог долгой и активной жизни.',
        ];

        $title = $titles[array_rand($titles)];
        // Добавляем уникальный идентификатор к slug для предотвращения дублирования
        $slug = \Illuminate\Support\Str::slug($title) . '-' . uniqid();

        // Генерируем контент из 3-5 случайных параграфов
        $numParagraphs = rand(3, 5);
        $selectedParagraphs = [];
        $availableParagraphs = $contentParagraphs;

        for ($i = 0; $i < $numParagraphs; $i++) {
            $key = array_rand($availableParagraphs);
            $selectedParagraphs[] = $availableParagraphs[$key];
            unset($availableParagraphs[$key]);
        }

        $content = implode("\n\n", $selectedParagraphs);

        return [
            'category_id' => \App\Models\Category::inRandomOrder()->first()->id ?? \App\Models\Category::create(['title' => 'Default', 'slug' => 'default'])->id,
            'title' => $title,
            'slug' => $slug,
            'excerpt' => $excerpts[array_rand($excerpts)],
            'content' => $content,
            'image' => null,
            'is_published' => true,
            'published_at' => now()->subDays(rand(1, 365)),
            'views' => rand(50, 5000),
            'meta_title' => $title . ' | Glucosa - Всё о диабете',
            'meta_description' => $excerpts[array_rand($excerpts)],
        ];
    }
}
