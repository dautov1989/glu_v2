# Система категорий для GLU v2

## Обзор

Создана полнофункциональная система категорий с поддержкой 4-уровневой иерархии для медицинского портала о диабете.

## Структура базы данных

### Таблица `categories`

| Поле | Тип | Описание |
|------|-----|----------|
| `id` | bigint | Первичный ключ |
| `parent_id` | bigint (nullable) | ID родительской категории |
| `title` | string | Название категории |
| `slug` | string (unique) | URL-friendly идентификатор |
| `level` | tinyint | Уровень вложенности (0-3) |
| `order` | integer | Порядок сортировки |
| `is_active` | boolean | Статус активности |
| `description` | text (nullable) | Описание категории |
| `meta_title` | string (nullable) | SEO заголовок |
| `meta_description` | string (nullable) | SEO описание |
| `icon` | string (nullable) | Путь к иконке |
| `image` | string (nullable) | Путь к изображению |
| `settings` | json (nullable) | Дополнительные настройки |
| `created_at` | timestamp | Дата создания |
| `updated_at` | timestamp | Дата обновления |

### Индексы

- `parent_id` - для быстрого поиска дочерних категорий
- `level` - для фильтрации по уровню
- `is_active` - для выборки активных категорий
- `parent_id, order` - для сортировки внутри родителя

## Модель Category

### Основные методы

```php
// Получить родительскую категорию
$category->parent;

// Получить дочерние категории
$category->children;

// Получить все дочерние категории рекурсивно
$category->childrenRecursive;

// Получить корневые категории
Category::getRootCategories();

// Получить полное дерево категорий
Category::getTree();

// Получить хлебные крошки
$category->getBreadcrumbs();

// Проверки
$category->isRoot();
$category->hasChildren();
```

## Использование

### Запуск миграции

```bash
php artisan migrate
```

### Заполнение данными из cat.json

```bash
php artisan db:seed --class=CategorySeeder
```

Или заполнить всю базу:

```bash
php artisan db:seed
```

### Примеры использования в коде

#### Получить все корневые категории

```php
$rootCategories = Category::getRootCategories();
```

#### Получить полное дерево

```php
$tree = Category::getTree();
```

#### Получить категорию по slug

```php
$category = Category::where('slug', 'simptomy')->first();
```

#### Получить дочерние категории

```php
$children = $category->children;
```

#### Получить хлебные крошки

```php
$breadcrumbs = $category->getBreadcrumbs();
// Вернет массив категорий от корня до текущей
```

#### Создать новую категорию

```php
Category::create([
    'parent_id' => 1,
    'title' => 'Новая категория',
    'slug' => 'novaya-kategoriya', // Опционально, сгенерируется автоматически
    'level' => 1,
    'order' => 10,
    'is_active' => true,
    'description' => 'Описание категории',
]);
```

## Структура данных из cat.json

Файл содержит 5 основных категорий:

1. **Симптомы** - признаки диабета
2. **Диабет 1 типа** - инсулинотерапия, обучение, инновации
3. **Диабет 2 типа** - медикаменты, осложнения, контроль веса
4. **Гаджеты и Расходники** - глюкометры, CGM, инсулиновые гаджеты
5. **Питание** - база знаний, продукты, меню
6. **Спорт** - виды нагрузок, управление диабетом, экипировка

Каждая категория имеет до 4 уровней вложенности.

## Особенности реализации

1. **Автоматическая генерация slug** - при создании/обновлении категории slug генерируется автоматически из title
2. **Уникальность slug** - система гарантирует уникальность slug, добавляя числовой суффикс при необходимости
3. **Каскадное удаление** - при удалении родительской категории удаляются все дочерние
4. **Рекурсивная загрузка** - метод `childrenRecursive()` позволяет загрузить всё дерево одним запросом
5. **Индексы** - оптимизированы для быстрой работы с иерархией

## Следующие шаги

1. Создать контроллер для работы с категориями
2. Создать API endpoints для получения категорий
3. Создать компоненты для отображения меню категорий
4. Добавить связь категорий со статьями/постами
