<!DOCTYPE html>
<html lang="ru">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>API Tester - glu_v2</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script defer src="https://cdn.jsdelivr.net/npm/alpinejs@3.x.x/dist/cdn.min.js"></script>
    <style>
        [x-cloak] {
            display: none !important;
        }

        pre {
            white-space: pre-wrap;
            word-wrap: break-word;
        }
    </style>
</head>

<body class="bg-gray-100 min-h-screen p-6 font-sans" x-data="apiTester()">
    <div class="max-w-7xl mx-auto">
        <header class="mb-8 text-center">
            <h1 class="text-4xl font-bold text-gray-800 mb-2">üß™ API Tester</h1>
            <p class="text-gray-600">Comprehensive testing tool for glu_v2 API</p>
        </header>

        <!-- Configuration -->
        <div class="bg-white rounded-xl shadow-md p-6 mb-8">
            <h2 class="text-xl font-semibold mb-4 flex items-center">
                <span class="text-2xl mr-2">‚öôÔ∏è</span> Configuration
            </h2>
            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-1">API Key</label>
                    <input type="text" x-model="apiKey"
                        class="w-full p-2 border rounded-md focus:ring-2 focus:ring-blue-500 focus:border-blue-500"
                        placeholder="Enter API Key">
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-1">Base URL</label>
                    <input type="text" x-model="baseUrl"
                        class="w-full p-2 border rounded-md focus:ring-2 focus:ring-blue-500 focus:border-blue-500"
                        placeholder="https://glu_v2.test/api">
                </div>
            </div>
        </div>

        <!-- Tabs -->
        <div class="mb-6 border-b border-gray-200">
            <nav class="-mb-px flex space-x-8" aria-label="Tabs">
                <button @click="activeTab = 'general'"
                    :class="{'border-blue-500 text-blue-600': activeTab === 'general', 'border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300': activeTab !== 'general'}"
                    class="whitespace-nowrap py-4 px-1 border-b-2 font-medium text-sm">
                    General & Categories
                </button>
                <button @click="activeTab = 'content'"
                    :class="{'border-blue-500 text-blue-600': activeTab === 'content', 'border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300': activeTab !== 'content'}"
                    class="whitespace-nowrap py-4 px-1 border-b-2 font-medium text-sm">
                    ü§ñ AI Content
                </button>
                <button @click="activeTab = 'posts'"
                    :class="{'border-blue-500 text-blue-600': activeTab === 'posts', 'border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300': activeTab !== 'posts'}"
                    class="whitespace-nowrap py-4 px-1 border-b-2 font-medium text-sm">
                    üìù Posts CRUD
                </button>
            </nav>
        </div>

        <!-- General Tab -->
        <div x-show="activeTab === 'general'" x-cloak class="grid grid-cols-1 md:grid-cols-2 gap-6">
            <!-- Test Connection -->
            <div class="bg-white rounded-xl shadow-md p-6">
                <h3 class="text-lg font-semibold mb-2">üîå Test Connection</h3>
                <p class="text-gray-500 text-sm mb-4">GET /test (No Auth)</p>
                <button @click="makeRequest('/test', 'GET', null, false)"
                    class="bg-indigo-600 text-white px-4 py-2 rounded hover:bg-indigo-700 transition">Ping API</button>
                <div x-show="responses['/test']"
                    class="mt-4 bg-gray-50 p-3 rounded text-xs font-mono overflow-auto max-h-40">
                    <pre x-text="JSON.stringify(responses['/test'], null, 2)"></pre>
                </div>
            </div>

            <!-- Get Categories -->
            <div class="bg-white rounded-xl shadow-md p-6">
                <h3 class="text-lg font-semibold mb-2">üìÇ Get Categories</h3>
                <p class="text-gray-500 text-sm mb-4">GET /categories</p>
                <button @click="makeRequest('/categories')"
                    class="bg-green-600 text-white px-4 py-2 rounded hover:bg-green-700 transition">Fetch
                    Categories</button>
                <div x-show="responses['/categories']"
                    class="mt-4 bg-gray-50 p-3 rounded text-xs font-mono overflow-auto max-h-60">
                    <pre x-text="JSON.stringify(responses['/categories'], null, 2)"></pre>
                </div>
            </div>
        </div>

        <!-- Content Tab -->
        <div x-show="activeTab === 'content'" x-cloak class="space-y-6">
            <div class="bg-white rounded-xl shadow-md p-6">
                <div class="flex justify-between items-start">
                    <div>
                        <h3 class="text-lg font-semibold mb-2">üß† Smart Suggestion (n8n)</h3>
                        <p class="text-gray-500 text-sm mb-4">GET /content/suggest - Get context for AI article
                            generation</p>
                    </div>
                    <button @click="makeRequest('/content/suggest')"
                        class="bg-purple-600 text-white px-6 py-2 rounded hover:bg-purple-700 transition shadow-lg">
                        Generate Suggestion
                    </button>
                </div>

                <div x-show="responses['/content/suggest']" class="mt-6">
                    <div
                        class="bg-gray-900 text-green-400 p-4 rounded-lg font-mono text-sm overflow-auto max-h-[500px]">
                        <pre x-text="JSON.stringify(responses['/content/suggest'], null, 2)"></pre>
                    </div>
                </div>
            </div>
        </div>

        <!-- Posts Tab -->
        <div x-show="activeTab === 'posts'" x-cloak class="grid grid-cols-1 lg:grid-cols-2 gap-6">
            <!-- List Posts -->
            <div class="bg-white rounded-xl shadow-md p-6 lg:col-span-2">
                <div class="flex justify-between items-center mb-4">
                    <h3 class="text-lg font-semibold">üìö List Posts</h3>
                    <button @click="makeRequest('/posts')"
                        class="bg-blue-600 text-white px-4 py-2 rounded hover:bg-blue-700 transition">Refresh
                        List</button>
                </div>
                <div x-show="responses['/posts']"
                    class="bg-gray-50 p-3 rounded text-xs font-mono overflow-auto max-h-60">
                    <pre x-text="JSON.stringify(responses['/posts'], null, 2)"></pre>
                </div>
            </div>

            <!-- Create Post -->
            <div class="bg-white rounded-xl shadow-md p-6">
                <h3 class="text-lg font-semibold mb-4">‚ú® Create Post</h3>
                <div class="space-y-3">
                    <input type="text" x-model="newPost.title" placeholder="Title" class="w-full p-2 border rounded">
                    <input type="number" x-model="newPost.category_id" placeholder="Category ID"
                        class="w-full p-2 border rounded">
                    <textarea x-model="newPost.content" placeholder="Content (HTML allowed)"
                        class="w-full p-2 border rounded h-32"></textarea>
                    <label class="flex items-center space-x-2">
                        <input type="checkbox" x-model="newPost.is_published" class="rounded text-blue-600">
                        <span>Publish immediately</span>
                    </label>
                    <button @click="createPost()"
                        class="w-full bg-indigo-600 text-white px-4 py-2 rounded hover:bg-indigo-700 transition">Create
                        Post</button>
                </div>
                <div x-show="responses['create_post']"
                    class="mt-4 bg-gray-50 p-3 rounded text-xs font-mono overflow-auto max-h-40">
                    <pre x-text="JSON.stringify(responses['create_post'], null, 2)"></pre>
                </div>
            </div>

            <!-- Single Post Operations -->
            <div class="bg-white rounded-xl shadow-md p-6">
                <h3 class="text-lg font-semibold mb-4">üîß Single Post Operations</h3>
                <div class="flex space-x-2 mb-4">
                    <input type="number" x-model="targetPostId" placeholder="Post ID" class="flex-1 p-2 border rounded">
                </div>

                <div class="grid grid-cols-3 gap-2 mb-4">
                    <button @click="makeRequest(`/posts/${targetPostId}`, 'GET', null, true, 'get_post')"
                        class="bg-gray-600 text-white px-3 py-2 rounded hover:bg-gray-700">Get</button>
                    <button @click="updatePost()"
                        class="bg-yellow-600 text-white px-3 py-2 rounded hover:bg-yellow-700">Update</button>
                    <button @click="makeRequest(`/posts/${targetPostId}`, 'DELETE', null, true, 'delete_post')"
                        class="bg-red-600 text-white px-3 py-2 rounded hover:bg-red-700">Delete</button>
                </div>

                <!-- Update Fields -->
                <div class="space-y-3 border-t pt-4">
                    <p class="text-xs text-gray-500">Update Data:</p>
                    <input type="text" x-model="updateData.title" placeholder="New Title"
                        class="w-full p-2 border rounded text-sm">
                    <textarea x-model="updateData.content" placeholder="New Content"
                        class="w-full p-2 border rounded h-20 text-sm"></textarea>
                </div>

                <div x-show="responses['single_post_op']"
                    class="mt-4 bg-gray-50 p-3 rounded text-xs font-mono overflow-auto max-h-40">
                    <pre x-text="JSON.stringify(responses['single_post_op'], null, 2)"></pre>
                </div>
            </div>
        </div>
    </div>

    <script>
        function apiTester() {
            return {
                activeTab: 'general',
                apiKey: 'ad064f1e19dec7de49426c54c16b439f38795d39cde1da15c848cd0442098dd7',
                baseUrl: 'https://glu_v2.test/api',
                responses: {},
                newPost: {
                    title: '',
                    category_id: 1,
                    content: '',
                    is_published: true
                },
                targetPostId: '',
                updateData: {
                    title: '',
                    content: ''
                },

                async makeRequest(endpoint, method = 'GET', body = null, requireAuth = true, responseKey = null) {
                    const key = responseKey || endpoint;
                    this.responses[key] = { status: 'Loading...' };

                    const headers = {
                        'Accept': 'application/json',
                        'Content-Type': 'application/json'
                    };

                    if (requireAuth) {
                        headers['X-API-Key'] = this.apiKey;
                    }

                    try {
                        const res = await fetch(`${this.baseUrl}${endpoint}`, {
                            method,
                            headers,
                            body: body ? JSON.stringify(body) : null
                        });

                        const data = await res.json();
                        this.responses[key] = data;

                        // Auto-fill update fields if getting a post
                        if (method === 'GET' && endpoint.includes('/posts/') && data.data) {
                            this.updateData.title = data.data.title;
                            this.updateData.content = data.data.content;
                        }

                    } catch (error) {
                        this.responses[key] = { error: error.message };
                    }
                },

                async createPost() {
                    if (!this.newPost.title || !this.newPost.content) {
                        alert('Please fill in title and content');
                        return;
                    }
                    await this.makeRequest('/posts', 'POST', this.newPost, true, 'create_post');
                },

                async updatePost() {
                    if (!this.targetPostId) {
                        alert('Please enter a Post ID');
                        return;
                    }
                    const body = {};
                    if (this.updateData.title) body.title = this.updateData.title;
                    if (this.updateData.content) body.content = this.updateData.content;

                    await this.makeRequest(`/posts/${this.targetPostId}`, 'PUT', body, true, 'single_post_op');
                }
            }
        }
    </script>
</body>

</html>